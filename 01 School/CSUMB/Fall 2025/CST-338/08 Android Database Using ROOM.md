---
ðŸ“• Courses:
  - "[[!!Software Design]]"
tags:
  - ComputerScience
  - ComputerScience/Android
  - ComputerScience/Databases
Date Created: 2025-11-04
---
```table-of-contents
```
---
# SQLite and Android
- [SQLite](http://www.sqlite.org/) is an open-source database
- It provides standard relational database features and requires limited memory at runtime (approx. 250 Kilobytes)
- SQLite is embedded into every Android device
	- Using an SQLite database in Android does not require a setup procedure or administration of the database
- The **android.database.sqlite** package contains needed classes

# Why Use a DB
- If we want persistent data, we need to save it
- savedInstanceState only lasts while the app is running
- Catching results from a remote server

# Why Use SQLite?
- SQLite is a relational database management system, or RDBMS
- SQLite stores data in simple text files, rather than in a special data format
- It is also open source, popular, free, and relatively easy to use
## Quirks of SQLite
- SQLite supports 3 data types:
	- TEXT
		- Strings etc.
	- INTEGER
		- Whole numbers
	- REAL
		- Fractional numbers
- We will need to convert some values
	- Dates -> Long (getTime())
	- Boolean -> bool ? 1 : 0;

# Android Room ORM Architecture
- ORM (Object Relational Mapping)
	- A layer over SQLite that returns Objects rather than sql rows
- DAO (Data Access Object)
	- defines methods for retrieving objects from the database
	- Database methods such as insert, update, and delete
- Room Database
	- A singleton object that is used to get a reference to a DAO
	- An abstract class
- Room wrapper generates:
	- A class that implements the DAO interface
	- Class that subclasses RoomDatabase
	- The application programmers (us) do not need to know the details
![[Pasted image 20251104101225.png|550]]

# SQL - Structured Query Language
- Data is stored in tables on the file system
- Columns have a name and data type
- Row has a primary key which can be generated by the application or by the database
- Statements
	- define or remove table: `CREATE TABLE`, `DROP TABLE`, ...
	- retrieving rows: `SELECT` ...
	- modifying rows: `UPDATE`, `DELETE`, `INSERT`
![[Pasted image 20251104101455.png|550]]
## SQL - Statements, Cruddy
- CRUD
	- **C**reate
		- `CREATE TABLE`
		- `INSERT` records
	- **R**etrieve
		- `SELECT` words
	- **U**pdate
		- `UPDATE` records
	- **D**estroy
		- `DROP TABLE`, ...
		- Delete records
### CREATE
```sqlite
CREATE TABLE books (
	id INTEGER PRIMARY KEY AUTOINCREMENT,
	title TEXT,
	author TEXT,
	price REAL )
```
- The `AUTOINCREMENT` key indicates that the id value is generated by the database when a new row is inserted into table
### SELECT
```sqlite
SELECT * FROM books /* selects ALL rows and ALL columns in the table boooks */

SELECT * FROM books ORDER BY price /* sorted by price(low to high) */

SELECT * FROM books ORDER BY price desc /* retrieve by price(high to low) */

SELECT * FROM books WHERE ID = :id /* :id is placeholder for value passed in for :id */

SELECT * FROM books WHERE price < :p /* all records from books where price less than parameter :p */

SELECT * FROM books WHERE price = :p AND id = :id /* all records where price == p and id == id */
```

# Steps Needed to Use Room
#### 1/4
- Add room to your project
	- Room is an optional component in Android architecture
	- Add a few lines to our Gradle file
```kotlin
dependencies {
	def room_version = "2.7.0"
	
	implementation "androidx.room:room-runtime:$room_version"
	annotationProcessor "androidx.room:room-compiler:$room_version"
}
```
>[Documentation](https://developer.android.com/training/data-storage/room)
#### 2/4
- Define and annotate Model classes
	- These are Plain Old Java Objects (POJOs)
	- They have fields just like we have seen before
	- add annotation for `@Entity`, `@PrimaryKey`, etc.
```java
@Entity(tableName =  
GymLogDatabase.GYM_LOG_TABLE)  
public class GymLog {  
	@PrimaryKey(autoGenerate = true)  
	private int id;  
	private String exercise;  
	private double weight;  
	private int reps;  
	private LocalDateTime date;  
	private int userId;
```
#### 3/4
- Define and annotate a DAO (Data Access Object) interface
	- methods for retrieving and updating database
```java
@Dao  
public interface GymLogDAO {  
	@Insert(onConflict = OnConflictStrategy.REPLACE)  
	void insert(GymLog gymlog);  
	
	@Query("SELECT * FROM " + GymLogDatabase.GYM_LOG_TABLE +  
		" ORDER BY date DESC")  
	List<GymLog> getAllRecords(); 
	 
	@Query("SELECT * FROM " + GymLogDatabase.GYM_LOG_TABLE +  
		" WHERE userId = :loggedInUserId ORDER BY date DESC")  
	List<GymLog> getRecordsetUserId(int loggedInUserId)
```
#### 4/4
- Define an abstract subclass of RoomDatabase
	- used via the singleton pattern
	- defines abstract methods that return DAOs
	- @Database annotation includes list of all @Entity classes
```java
@TypeConverters(LocalDateTypeConverter.class)  
@Database(entities = {GymLog.class, User.class}, version = 1, exportSchema = false)  
public abstract class GymLogDatabase extends RoomDatabase { 
 
static GymLogDatabase getDatabase(final Context context) {  
	if (INSTANCE == null) {  
		synchronized (GymLogDatabase.class) {  
			if (INSTANCE == null) {  
				INSTANCE = Room.databaseBuilder(  
						context.getApplicationContext(),  
						GymLogDatabase.class,  
						DATABASE_NAME  
					)  
					.fallbackToDestructiveMigration()  
					.addCallback(addDefaultValues)  
					.build();  
				}  
			}  
		}  
	return INSTANCE;  
}
```
#### Summary
1. Add room to your project
2. Define and annotate Model classes
3. Define and annotate a DAO (Data Access Object) interface
4. Define an abstract subclass of Room Database

# Type Converters
## Make a New Class
![[Pasted image 20251104103530.png|500]]
- Converting from a Date to a... We need this to be a numeric
	- Specifically an integer
		- More specifically a LONG integer
```kotlin
import androidx.room.TypeConverter;

import java.util.Date;

public class DateTypeConverter {
	@TypeConverter
	public long convertDateToLong(Date date) {
		return date.getTime();
	}
	
	@TypeConverter
	public Date convertLongtoLocalDate(long epoch) {
		return new Date(epoch);
	}
}
```

# Deleting the Database
- Room will create the database with empty tables when you start app and Room detects no database exists
- Sometimes you need to force Room to recreate database
	- because you change the definition of the Model entity classes due to adding or changing an entity class
- option 1: Use AVD tool to wipe data on the emulator
- option 2: Wipe all the storage from the device
- option 3: Uninstall the application from device

# To Populate Initial Data to Database
- Room creates an empty database
- To load the database with initial data
	- Create a callback in the database definition
	- Shown in the supplied recordings (CST338)
	- Also in the Room with a View Website (CST338 canvas)
---
# References
1. 